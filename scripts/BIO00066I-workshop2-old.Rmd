---
title: 'BIO00066I Cell Biology: Workshop 2'
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cerulean
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
    highlight: tango
  pdf_document:
    toc: yes
  word_document:
    toc: yes
editor_options:
  markdown:
    wrap: 72
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Step 0: Make a R Studio project.

There are two ways to do this:

1.  Open the **File** menu, and choose **New Project**.
2.  Use the Projects drop-down menu at the very **top right** of the R
    Studio window

------------------------------------------------------------------------

## Setting up the R Studio environment

First, we set up our R Studio environment, with these commands:

```{r}

#clear previous data
rm(list=ls())

#The tidyverse!
library(tidyverse)

#we need this to make pretty plots with the 'ggarrange' package
library(ggpubr)

```

------------------------------------------------------------------------

# Step 1. Getting to know the data

Load the data and see what it looks like.

We will load some data from a website.

```{r}
cells<-read_tsv(url("https://djeffares.github.io/data/BIO00066I/A1-FFT.tsv"))
```

### First glimpses of the data

The **cells** object is a *tibble*, which is a tidyverse version of a
*data frame*, with rows (which are usually different observations) and
columns (which are usually different features or aspects of the
observations). Like an excel spreadsheet.

It is important to know what data you have in your tibble. I like to
know:

-   How many rows and columns there are
-   What the column names are
-   What types of values the columns of data have (numeric, factors, or
    text?)

Here are some ways to find this out for our **cells** tibble.

1.  Use the **view(cells)** command (shows the data in a popup window)
2.  Use the **glimpse(cells)** command (counts rows and columns, and
    shows some of the data)
3.  Use the **summary(cells)** command (shows a summary of averages,
    medians and so on)

Try **view** now. This will open a new tab that looks like excel.

You can close this tab, or just clock back you your script.

```{r}
#try view
view(cells)
```

Now try glimpse

```{r}
glimpse(cells)
```

We have 21291 rows, and 23 columns. The **glimpse** command shows
information about each column on a new line like:

**\## \$ frame** <dbl> 1, 2, 1

We have column names like: *frame*, *untracked* and *tracking.id*.

The <dbl> on each line means that the data type is a numeric values with
decimal points.

It is important to use at least one of these when you first read in a
new data set - to check that it is all OK.

------------------------------------------------------------------------

### Data hygiene

It is important to save your work regularly, and to be organised.
Organising files, data and scripts is called **data hygiene**. So take
these steps now to keep up your data hygiene:

-   save your script (from the file menu, or the hot keys: ⌘S on a mac,
    ctrl-s on a PC)
-   save all your data objects using the **save.image** command as below

```{r}
#first record today's date in a variable
date.today<-Sys.Date()

#then create an Rda (R data object file name)
rda.file.name<-paste("BIO00066I,workshop2.",date.today,".Rda",sep="")

#then save the image (which contains all variables)
save.image(rda.file.name)
```

Why put today's date in the file name?

This is a kind of *'date stamp'*. Naming files in this say helps you to keep track of when you made the file.
This is part of data hygiene.

------------------------------------------------------------------------

# Step 2. Working with all the data

So far we have looked at the data from one file: **A1-FFT.tsv**. This
contains XXX.

There is other data that is either replicate XXX, or a different cell
type (XXX).

The data we have are:

**three replicates of XXX** files:

-   A1-FFT.tsv
-   A2-FFT.tsv
-   A3-FFT.tsv

**three replicates of XXX** files:

-   B1-FFT.tsv
-   B2-FFT.tsv
-   B3-FFT.tsv

------------------------------------------------------------------------

## Reading in more data files

First, read in the files on by one:

```{r, messages=FALSE}
#all the XXX files
A1 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/A1-FFT.tsv"))
A2 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/A2-FFT.tsv"))
A3 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/A3-FFT.tsv"))

#all the XXX files
B1 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/B1-FFT.tsv"))
B2 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/B2-FFT.tsv"))
B3 <-read_tsv(url("https://djeffares.github.io/data/BIO00066I/B3-FFT.tsv"))

```

Let's save our data again:

```{r}
save.image(rda.file.name)
```

------------------------------------------------------------------------

### Using bind_rows

Now we have many tibbles: cells, A1, A2, A3, B1, B2 and B3.

While its OK to have all these objects, many of the functions of [the
tidyverse](https://www.tidyverse.org/), are designed to work with
\*\*one tibble\* that contains all the data.

Let's put all the **A** data (XXX) into one tibble.

```{r}
A.all<-bind_rows(list(A1, A2, A3), .id = "replicate")
```

Because we used **.id = "replicate"** we should now have a new column
called **replicate**. Check it is present with usi **unique** (which shows us just the unique set of values this column has).

```{r,eval=F}
unique(A.all$replicate)
```

Now put all the **B** data (YYY) into one tibble.

```{r}
B.all<-bind_rows(list(B1, B2, B3), .id = "replicate")
```

------------------------------------------------------------------------

### Making one tidy file

We can use **bind_rows** to bind A.all and B.all.

This time, it would be better to define the cell type XXX in a new
column, so we can identify this later. So let's add these now. It is
easy to add a new column to a tibble with, like this:

```{r}
A.all$cell.type='cloneA'
B.all$cell.type='cloneB'
```

Finally do the bind_rows:

```{r}
cells<-bind_rows(A.all, B.all)
```

And do some careful checking, to examine what we have:

```{r, echo=FALSE}
#get a glimpse of the data:
glimpse(cells)

#check our column names
names(cells)
```

# Step 3. Save your data

To finish up, we'll remove the A1, A2 *etc*, and save our data again.

Also - don't forget to save your script.

```{r}
rm(A1,A2,A3,B1,B2,B3)
save.image(rda.file.name)
```


# Step 4. Making first plots

From our first views of the data, it looks like we have these values
that could be important to understand.

-   volume.um
-   radius.um
-   width.um
-   dry.mass.pgs
-   area.um
-   length.um

A good way of understanding data is to plot it.

PS: In all these values **um** means microns. These are usually
represented as **µm**.

### Plot a histogram

Histograms can sometimes be useful.Let's see:

```{r}
ggplot(cells, aes(x=volume.um))+
  geom_histogram()
```

### Density plots

A density plot might be be better. So let's try that.

```{r}
ggplot(cells, aes(x=volume.um))+
  geom_density()+
  theme_light()
```

Now examine the **radius** using a **density plot**.

```{r}
ggplot(cells, aes(x=radius.um))+
  geom_density()+
  theme_light()
```

Looks like there might be **two populations** here, perhaps?

------------------------------------------------------------------------

### Arranging many plots together

Sometimes we want more than one plot on a page. The simple way to do this is to use **ggarrange**.

First, we make one plot, and we **save** this plot as an object, called **volume.plot** in this case.

```{r}
#volumne
volume.plot<-ggplot(cells, aes(x=width.um))+
  geom_density()+
  theme_light()
```


Now make another plot, and save this plot as an object with another sensible name. Sensible clear object names are another element of data hygiene.

```{r}
#radius
radius.plot<-ggplot(cells, aes(x=radius.um))+
  geom_density()+
  theme_light()
```

Now we can arrange these plots onto one page.

- **ncol** specifies the number of columns the 'plot grid' has
- **nrow** specifies the number of rows the 'plot grid' has


```{r}
density.plots<-ggarrange(
  volume.plot,
  radius.plot,
  ncol = 2, 
  nrow = 1
)
```


Now save the plot as a jpeg. The default width and height = 7, so lets make it wider.
```{r}
#plot filename
ggsave(density.plots,
  file="plots/volume-and-radius.density.plots.jpeg",
  width = 7*2,
  height = 7
)
```

------------------------------------------------------------------------

## Final comments

We now have a simple, saved tidyverse-compliant data file. We saved our
data in a file called **BIO00066I.workshop2.2023-12-25.Rda**.

**Keep this file somewhere safe, or email it to yourself.**

PS: It may feel like we didn't do very much biology today. But because
we created a simple tidy object all our data analysis will be much
easier from now on.

## End
cells <- cells |> 
    mutate(length.to.width = length.um/width.um)

names(cells)

plot.a<- cells |>
    filter(cell.type=="cloneA") |> 
    ggplot(aes(x=log10(area.um), y= length.to.width, colour = cell.type))+
    geom_2d()
    
plot.b<- cells |>
    filter(cell.type=="YYY") |> 
    ggplot(aes(x=log10(area.um), y= length.to.width, colour = cell.type))+
    geom_point()

ggarrange(plot.a, plot.b)

cells |> 
    filter(-cell.type)
    


