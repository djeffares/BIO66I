<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Daniel Jeffares">
<meta name="dcterms.date" content="2024-01-25">
<title>BIO00066I - BIO00066I Workshop 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BIO00066I</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./workshop2.html"> 
<span class="menu-text">Workshop 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./workshop3.html" aria-current="page"> 
<span class="menu-text">Workshop 3</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
<li>
<a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">1</span> Learning objectives</a>
  <ul class="collapse">
<li><a href="#technical-skills" id="toc-technical-skills" class="nav-link" data-scroll-target="#technical-skills"><span class="header-section-number">1.1</span> Technical skills</a></li>
  <li><a href="#thinking-like-a-data-scientist" id="toc-thinking-like-a-data-scientist" class="nav-link" data-scroll-target="#thinking-like-a-data-scientist"><span class="header-section-number">1.2</span> Thinking like a data scientist</a></li>
  </ul>
</li>
  <li>
<a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a>
  <ul class="collapse">
<li><a href="#the-biology" id="toc-the-biology" class="nav-link" data-scroll-target="#the-biology"><span class="header-section-number">2.1</span> The biology</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="header-section-number">2.2</span> The data</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions"><span class="header-section-number">2.3</span> Research questions</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3</span> Exercises</a>
  <ul class="collapse">
<li><a href="#setting-up" id="toc-setting-up" class="nav-link" data-scroll-target="#setting-up"><span class="header-section-number">3.1</span> Setting up</a></li>
  <li><a href="#automated-livecyte-cell-movment-data" id="toc-automated-livecyte-cell-movment-data" class="nav-link" data-scroll-target="#automated-livecyte-cell-movment-data"><span class="header-section-number">3.2</span> Automated Livecyte cell movment data</a></li>
  <li><a href="#making-plots" id="toc-making-plots" class="nav-link" data-scroll-target="#making-plots"><span class="header-section-number">3.3</span> Making plots</a></li>
  <li><a href="#manual-tracking-data" id="toc-manual-tracking-data" class="nav-link" data-scroll-target="#manual-tracking-data"><span class="header-section-number">3.4</span> Manual tracking data</a></li>
  <li><a href="#plotting-manual-tracking-data" id="toc-plotting-manual-tracking-data" class="nav-link" data-scroll-target="#plotting-manual-tracking-data"><span class="header-section-number">3.5</span> Plotting manual tracking data</a></li>
  <li><a href="#correlations-abound" id="toc-correlations-abound" class="nav-link" data-scroll-target="#correlations-abound"><span class="header-section-number">3.6</span> Correlations abound!</a></li>
  </ul>
</li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">4</span> Reflection</a></li>
  <li>
<a href="#after-the-workshop" id="toc-after-the-workshop" class="nav-link" data-scroll-target="#after-the-workshop"><span class="header-section-number">5</span> After the workshop</a>
  <ul class="collapse">
<li><a href="#consolodation-exercises" id="toc-consolodation-exercises" class="nav-link" data-scroll-target="#consolodation-exercises"><span class="header-section-number">5.1</span> Consolodation exercises</a></li>
  <li><a href="#planning-for-your-report" id="toc-planning-for-your-report" class="nav-link" data-scroll-target="#planning-for-your-report"><span class="header-section-number">5.2</span> Planning for your report</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">BIO00066I Workshop 3</h1>
<p class="subtitle lead">Cell Biology Data Analysis Workshop 3</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Jeffares </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Work in progress
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page is a work in progress.</p>
</div>
</div>
<section id="learning-objectives" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Learning objectives</h1>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Philosophy
</div>
</div>
<div class="callout-body-container callout-body">
<p>Workshops are not a test. You may make a lot of mistakes - that is fine. It’s OK to need help. the staff are here to help you, so don’t be afraid to ask for help! :-)</p>
</div>
</div>
<section id="technical-skills" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="technical-skills">
<span class="header-section-number">1.1</span> Technical skills</h2>
<p>Today we will work with plotting movement data from the Livecyte microscope.</p>
<p>We will learn some new R plotting skills:</p>
<ul>
<li>
<code>facet_wrap</code> a method to plot one variable split up over different treatments (or chromosomes, or days, or replicates)</li>
<li>how to create a <strong>correlation data frame</strong> using the <code>correlate</code> function. This allows us to explore many correlations between different metrics. Typically, these metrics are stored in the <em>columns</em> of our data frames.</li>
</ul></section><section id="thinking-like-a-data-scientist" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="thinking-like-a-data-scientist">
<span class="header-section-number">1.2</span> Thinking like a data scientist</h2>
<p>We encourage you to develop your data handling skills. By:</p>
<ul>
<li>keeping our script clear, simple, and well-annotated</li>
<li>developing your own habits to keep your awareness on <strong>what data the data contains</strong>
</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Know your data!
</div>
</div>
<div class="callout-body-container callout-body">
<p>To understand the biology captured in the data, you need to know what is in the data. At each step, be sure you know the rows, the columns and what they mean. Keep notes about this in your script.</p>
</div>
</div>
</section></section><section id="introduction" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Introduction</h1>
<section id="the-biology" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="the-biology">
<span class="header-section-number">2.1</span> The biology</h2>
<p>Today, we will continue our quest to understand <strong>mesenchymal stromal cells (MSCs)</strong>. Remember, the two clones we are studying were both obtained from <em>one person</em>, and they have been transformed with telomerase to make them immortal (so they don’t age). Then, they have been cultured in a lab for years.</p>
<p>In <a href="https://djeffares.github.io/BIO66I/workshop2.html">workshop 2</a>, we saw that these two clones were different shapes. This time, we examine how they <em>move</em>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sometimes, asking a good question is the most important step!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why do these clones maintain different shapes after growing in the lab for so long? Why don’t they revert to being the same?</p>
</div>
</div>
</section><section id="the-data" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="the-data">
<span class="header-section-number">2.2</span> The data</h2>
<p>In this workshop, we first examine cell movement data that was collected in an automated way by the Livecyte microscope. This shows something interesting, but it is not very reliable, because the Livecyte is <em>not perfect</em> at tracking individual cells.</p>
<p>People are better at tracking individual cells. So we then look at some <em>manual</em> tracking data. We will se such metrics as <code>euclidean.distance</code> (how far the cells have moved), <code>mean.speed</code> (how fast they go), and <code>meandering.index</code> (how much they <em>meander</em> and change their minds about where they are going!).</p>
<p>While we could <em>guess</em> how the cells differ from looking down the microscope, we can use our data science skills in two ways to enrich our perception, by:</p>
<ul>
<li>showing metrics with plots - this will enhance out intuition</li>
<li>using statistical tests to test our intuitions</li>
<li>the tests will determine which metrics (if any) are <strong>significantly different</strong> between the clones</li>
</ul>
<p>This work transforms intuitions into evidence.</p>
</section><section id="research-questions" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="research-questions">
<span class="header-section-number">2.3</span> Research questions</h2>
<ul>
<li>Do the two mesenchymal stromal cell clones move differently?</li>
<li>What data set(s) are most reliable?</li>
<li>What are the best parameters to distinguish the clones?</li>
</ul></section></section><section id="exercises" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Exercises</h1>
<section id="setting-up" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="setting-up">
<span class="header-section-number">3.1</span> Setting up</h2>
<ul>
<li>Start up R Studio, and open your Project.</li>
<li>Open the script your worked on in <a href="https://djeffares.github.io/BIO66I/workshop2.html">workshop 2</a>
</li>
</ul>
<p>We will keep working on this script. We advise you to mark clearly where workshop 1, workshop 2 and workshop 3 are. Something like this will help:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">########################################################</span></span>
<span><span class="co">#WORKSHOP 3: CELL MOVEMENT DATA</span></span>
<span><span class="co">########################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then clear the previous work, and load the libraries we need:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#clear previous data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#load the tidyverse</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#load the corr library: this is for examining correlations between many metrics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/corrr">corrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#we need this to make pretty plots with the 'ggarrange' package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="automated-livecyte-cell-movment-data" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="automated-livecyte-cell-movment-data">
<span class="header-section-number">3.2</span> Automated Livecyte cell movment data</h2>
<p>Now read in the data from the file <strong>all-cell-data-FFT.filtered.2024-01-19.tsv</strong>. This contains some cell movment data.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read the automated Livecyte data</span></span>
<span><span class="va">cells</span> <span class="op">&lt;-</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://djeffares.github.io/BIO66I/all-cell-data-FFT.filtered.2024-01-19.tsv"</span><span class="op">)</span>,</span>
<span>                 col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>                   clone <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   replicate <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   tracking.id<span class="op">=</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   lineage.id<span class="op">=</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets see what data we have:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Keep it simple
</div>
</div>
<div class="callout-body-container callout-body">
<p>In data science, we can easily get confused. keep the data as simple as you can (but no simpler).</p>
</div>
</div>
<p>In the spirit of <strong>keeping it simple</strong>, let’s retain only the columns in this data frame that we need, using the <code>select</code> function. The <code>cells</code> data framt still have all the data, so it is not lost.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "clone"                    "replicate"               
 [3] "frame"                    "tracking.id"             
 [5] "lineage.id"               "position.x"              
 [7] "position.y"               "pixel.position.x"        
 [9] "pixel.position.y"         "volume"                  
[11] "mean.thickness"           "radius"                  
[13] "area"                     "sphericity"              
[15] "length"                   "width"                   
[17] "orientation"              "dry.mass"                
[19] "displacement"             "instantaneous.velocity"  
[21] "instantaneous.velocity.x" "instantaneous.velocity.y"
[23] "track.length"             "perimeter"               
[25] "length.to.width"         </code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select only the columns we need</span></span>
<span><span class="va">cell.move.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cells</span>,</span>
<span>        <span class="va">clone</span>,</span>
<span>        <span class="va">replicate</span>,</span>
<span>        <span class="va">displacement</span>, </span>
<span>        <span class="va">track.length</span>, </span>
<span>        <span class="va">instantaneous.velocity</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#check that we have</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cell.move.data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "clone"                  "replicate"              "displacement"          
[4] "track.length"           "instantaneous.velocity"</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#get a simple summaru, using summary and also glimpse</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cell.move.data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    clone       replicate  displacement     track.length   
 cloneA:55555   1:30373   Min.   :  0.00   Min.   :  0.00  
 cloneB:36330   2:36393   1st Qu.:  4.72   1st Qu.: 10.80  
                3:25119   Median : 22.17   Median : 46.59  
                          Mean   : 46.42   Mean   : 91.31  
                          3rd Qu.: 62.35   3rd Qu.:126.91  
                          Max.   :487.55   Max.   :984.29  
 instantaneous.velocity
 Min.   :0.0000000     
 1st Qu.:0.0008046     
 Median :0.0025395     
 Mean   :0.0035334     
 3rd Qu.:0.0050956     
 Max.   :0.0448467     </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">cell.move.data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 91,885
Columns: 5
$ clone                  &lt;fct&gt; cloneA, cloneA, cloneA, cloneA, cloneA, cloneA,…
$ replicate              &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ displacement           &lt;dbl&gt; 0.00, 14.96, 0.00, 10.92, 12.93, 14.13, 13.13, …
$ track.length           &lt;dbl&gt; 0.00, 14.96, 0.00, 10.92, 15.74, 21.72, 26.23, …
$ instantaneous.velocity &lt;dbl&gt; 0.000000000, 0.010829316, 0.000000000, 0.003954…</code></pre>
</div>
</div>
<p>Now save your working data:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#lets save our data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save.image</a></span><span class="op">(</span><span class="st">"BIO00066I-workshop3-cell-movement-metrics.Rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#you can load this any time later with:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"BIO00066I-workshop3-cell-movement-metrics.Rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="making-plots" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="making-plots">
<span class="header-section-number">3.3</span> Making plots</h2>
<p>let’s see how clone A and clone B move. First, we’ll plot the <code>instantaneous.velocity</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#instantaneous.velocity - geom_violin</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cell.move.data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">clone</span>,y<span class="op">=</span><span class="va">instantaneous.velocity</span>,colour<span class="op">=</span><span class="va">clone</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html">stat_compare_means</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot isn’t very revealing is it? That is because most of the <code>instantaneous.velocity</code> values are very low, and the data are certainly not <em>normally distributed</em>. Biological data is often like this. Plotting metrics on a <strong>log scale</strong> is often the solution. Log<sup>2</sup> or log<sup>10</sup> scales are commonly used.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Adjust this plot yourself
</div>
</div>
<div class="callout-body-container callout-body">
<p>So that you plot <code>y=log10(instantaneous.velocity)</code>. Does it look better?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Enhance the plot with facet_wrap
</div>
</div>
<div class="callout-body-container callout-body">
<p>This time, show the repeats by adding a new line to the plot code:</p>
<p><code>facet_wrap(~replicate)+</code></p>
<p><strong>What is <code>facet_wrap</code>?</strong>. Our <strong>first categorical value</strong> that we split up the data into was clone A and clone B. <code>facet_wrap</code> splits the data up again into a <strong>second categorical value</strong>, and plots each category. In this case our second category was <code>~replicate</code>.</p>
</div>
</div>
<p>If these adjustments to the code worked, you will end up with a plot like this. <strong>What does this tell you about clone movement?</strong>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop3_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Optional
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use your plot code to explore, <code>displacement</code>, <code>track.length</code> and/or <code>instantaneous.velocity</code>.</p>
</div>
</div>
</section><section id="manual-tracking-data" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="manual-tracking-data">
<span class="header-section-number">3.4</span> Manual tracking data</h2>
<p>Sometimes, the automated measurements are not the best quality. In this case, we know that the Livecyte microscope is not very good at tracking cells, so the cell movement metrics are not as good as we would like.</p>
<p>So Amanda spent many hours <em>manually</em> tracking cells. These results were processed into manual tracking data. First, load the data and of course <strong>examine what you have</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#load the manual tracking data</span></span>
<span><span class="va">track</span> <span class="op">&lt;-</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://djeffares.github.io/BIO66I/A1-and-B2-tracking.data.tsv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#check it out</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">track</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 201
Columns: 13
$ LID                           &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2…
$ TID                           &lt;dbl&gt; 1, 2, 3, 4, 5, 7, 8, 9, 10, 11, 12, 1, 2…
$ track.duration                &lt;dbl&gt; 230, 1587, 1702, 2484, 2484, 1725, 2484,…
$ track.length                  &lt;dbl&gt; 80.850, 633.822, 711.651, 963.285, 870.3…
$ meandering.index              &lt;dbl&gt; 0.08401856, 0.20254946, 0.47929912, 0.13…
$ euclidean.distance            &lt;dbl&gt; 6.79290, 128.38031, 341.09370, 128.90071…
$ mean.speed                    &lt;dbl&gt; 0.3515217, 0.3993837, 0.4181263, 0.38779…
$ track.present.at.start.or.end &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, TRUE, FALSE, T…
$ track.never.divides           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
$ start.time.total.time         &lt;dbl&gt; 0.00000000, 0.04166667, 0.30681818, 0.59…
$ end.time.total.time           &lt;dbl&gt; 0.03787879, 0.30303030, 0.58712121, 1.00…
$ track.duration.total.time     &lt;dbl&gt; 0.03787879, 0.26136364, 0.28030303, 0.40…
$ cell.line                     &lt;chr&gt; "A1", "A1", "A1", "A1", "A1", "A1", "A1"…</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">track</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "LID"                           "TID"                          
 [3] "track.duration"                "track.length"                 
 [5] "meandering.index"              "euclidean.distance"           
 [7] "mean.speed"                    "track.present.at.start.or.end"
 [9] "track.never.divides"           "start.time.total.time"        
[11] "end.time.total.time"           "track.duration.total.time"    
[13] "cell.line"                    </code></pre>
</div>
</div>
<p>In this data, <code>TID</code> is the Livecyte <strong>tracking ID</strong>, a unique number that the microscope gives to each ‘object’ it can identify. <code>LID</code> is the Livecyte <strong>lineage ID</strong>. This keeps track of the cell lineage (ie: the initial cells, and the subsequent daughter cells that are derived from it as it divides). When a cell divides, both ‘daughter cells’ keep the same <strong>lineage ID</strong>, but each is assigned a new unique <strong>tracking ID</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="docs/figure1.jpg" class="img-fluid figure-img"></p>
<figcaption><strong>Figure 1.</strong> The <strong>tracking ID (TID)</strong> is a unique ID that the microscope assigned to each object (cell), as it tracks it through time. The <strong>lineage ID (LID)</strong> is a number assigned to the ‘family’ of cells that derived by cell division during the the experiment. When a cell divides, each daughter cell is given a new tracking ID, but they keep their lineage ID, because they are still part of the same family.</figcaption></figure>
</div>
</section><section id="plotting-manual-tracking-data" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="plotting-manual-tracking-data">
<span class="header-section-number">3.5</span> Plotting manual tracking data</h2>
<p>Let’s start by looking at the <strong>distance</strong> that each cell has traveled during the experiment. This is recorded as <code>euclidean.distance</code>. This is the <em>shortest distance</em> between two points, so it does not take any meanderings into account. We can compare the clones (<code>cell.line</code>) like so:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#compare euclidean.distance between cell lines</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">track</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">cell.line</span>,y<span class="op">=</span><span class="va">euclidean.distance</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html">stat_compare_means</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Improve the plot
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try these things to improve this plot:</p>
<ul>
<li>use <code>geom_violin</code> instead of <code>geom_boxplot</code>
</li>
<li>adding <code>theme_classic</code>
</li>
<li>making the <em>x</em>-axis and <em>y</em>-axis look better with <code>xlab("something")</code> and <code>ylab("something")</code>
</li>
<li>giving the plot a title with <code>ggtitle("top title", subtitle ="sub text")</code>
</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Optional: alter the plot
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you have the plot looking the way you like, examine some of the other cell movement metrics. To find out what is available, use <code>names(track)</code>.</p>
</div>
</div>
</section><section id="correlations-abound" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="correlations-abound">
<span class="header-section-number">3.6</span> Correlations abound!</h2>
<p>With biological data (and data from many other sources), different measurements of the same set of ‘things’ are often correlated. For example, human height and weight are strongly correlated. So it is with cells.</p>
<p>We <em>could</em> examine each correlation one by one, like so:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#examine whether track.length and mean.speed are correlated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">track</span><span class="op">$</span><span class="va">track.length</span>,<span class="va">track</span><span class="op">$</span><span class="va">mean.speed</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  track$track.length and track$mean.speed
S = 701096, p-value = 1.92e-13
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.4741649 </code></pre>
</div>
</div>
<p>But since there are 11 cell movment metrics, this would quickly become boring. And (just as importantly) the data would be a challenge to understand.</p>
<p><strong>Fortunately, there is an easier way.</strong> First we use the <code>correlate</code> function to calculate all pairwise correlations. We save the correlation coefficients in the <code>track.correlations</code> data frame.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#calculate all pairwise correlations</span></span>
<span><span class="va">track.correlations</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">track</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://corrr.tidymodels.org/reference/correlate.html">correlate</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `track.present.at.start.or.end`, `track.never.divides`, and `cell.line`
Correlation computed with
• Method: 'spearman'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#see what we have</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">track.correlations</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  term                   LID    TID track.duration track.length meandering.index
  &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;
1 LID               NA       -0.148         0.0411       0.0346           0.0281
2 TID               -0.148   NA            -0.255       -0.268            0.221 
3 track.duration     0.0411  -0.255        NA            0.840           -0.477 
4 track.length       0.0346  -0.268         0.840       NA               -0.345 
5 meandering.index   0.0281   0.221        -0.477       -0.345           NA     
6 euclidean.distan…  0.00902 -0.133         0.413        0.626            0.407 
# ℹ 5 more variables: euclidean.distance &lt;dbl&gt;, mean.speed &lt;dbl&gt;,
#   start.time.total.time &lt;dbl&gt;, end.time.total.time &lt;dbl&gt;,
#   track.duration.total.time &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Then we use <code>pivot_longer</code> ass we did in <a href="https://3mmarand.github.io/R4BABS/r4babs4/week-1/workshop.html#visualisation">BIO00066I core workshop 1</a>, to simplify the data format.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://www.fromthebottomoftheheap.net/assets/img/posts/tidyr-longer-wider.gif" class="img-fluid figure-img"></p>
<figcaption><strong>Figure 2.</strong> How <code>pivot_longer</code> reshapes data. Notice that no data is lost. does.</figcaption></figure>
</div>
<p>We will use <code>pivot_longer</code> this way:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Adjust the name of the first column to "Variable1"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">track.correlations</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="st">"Variable1"</span></span>
<span></span>
<span><span class="co">#simplify the data with pivot_longer</span></span>
<span><span class="va">track.correlations.pivot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">track.correlations</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">Variable1</span>, names_to <span class="op">=</span> <span class="st">"Variable2"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#plot them! ggplot(track.correlations.pivot, aes(Var1, Var2)) + geom_tile(aes(fill = value)) + geom_text(aes(label = round(value, 1))) + scale_fill_gradient(low = “white”, high = “red”)+ theme_classic()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</p>
</section></section><section id="reflection" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Reflection</h1>
</section><section id="after-the-workshop" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> After the workshop</h1>
<section id="consolodation-exercises" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="consolodation-exercises">
<span class="header-section-number">5.1</span> Consolodation exercises</h2>
<p>Optional</p>
</section><section id="planning-for-your-report" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="planning-for-your-report">
<span class="header-section-number">5.2</span> Planning for your report</h2>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>